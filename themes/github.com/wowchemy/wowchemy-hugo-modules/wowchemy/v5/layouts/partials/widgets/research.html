{{ $ := .root }}
{{ $page := .page }}
{{ $pubs_len := len (where $.Site.RegularPages "Type" "research") }}

<!-- Research widget -->
<div class="row">
  <!-- Left column: Section heading -->
  <div class="col-xs-12 col-md-4 section-heading">
    <h1>{{ with $page.Title }}{{ . | markdownify }}{{ end }}</h1>
    {{ with $page.Params.subtitle }}
      <p>{{ . | markdownify }}</p>
    {{ end }}

    {{ if gt $pubs_len $page.Params.count }}
      <p class="view-all">
        <a href="{{ ($.Site.GetPage "section" "research").Permalink }}">
          {{ i18n "more_research" | markdownify }}
          <i class="fa fa-angle-double-right"></i>
        </a>
      </p>
    {{ end }}
  </div>

  <!-- Right column: Featured research -->
  <div class="col-xs-12 col-md-8">
    {{ with $page.Content }}
      <p>{{ . | markdownify }}</p>
    {{ end }}

    {{/* Pick only featured research */}}
    {{ $recent_research := where $.Site.RegularPages "Type" "research" "Params.featured" true }}
    {{ range first 1 $recent_research }}
      <div class="featured-research">
        <h2>{{ .Title }}</h2>
        {{ with .Params.abstract }}
          <p>{{ . }}</p>
        {{ end }}

        {{ with .Param "notes" }}
          <ul class="project-notes">
            {{ range . }}
              <li><em>{{ . }}</em></li>
            {{ end }}
          </ul>
        {{ end }}

        {{ partial "research_li_detailed" . }}
      </div>
    {{ end }}

    <!-- Optional button at bottom -->
    <p class="view-all">
      <a href="{{ ($.Site.GetPage "section" "research").Permalink }}">
        {{ i18n "more_research" | markdownify }}
        <i class="fa fa-angle-double-right"></i>
      </a>
    </p>
  </div>
</div>
